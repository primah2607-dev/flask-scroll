<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä Page Scroll Performance Monitor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f4f8;
            color: #1f2933;
            line-height: 1.6;
        }

        .header {
            background: #0f766e;
            color: white;
            padding: 20px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 14px;
            color: #a7f3d0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .upload-section {
            background: #e0e7ff;
            border: 2px solid #c7d2fe;
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .upload-section h2 {
            color: #1e40af;
            margin-bottom: 20px;
            font-size: 18px;
        }

        .file-upload {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .file-input-wrapper {
            flex: 1;
            min-width: 250px;
        }

        .file-input-wrapper label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #1e40af;
        }

        .file-input-wrapper input[type="file"] {
            width: 100%;
            padding: 10px;
            border: 2px dashed #6366f1;
            border-radius: 6px;
            background: white;
            cursor: pointer;
        }

        .file-input-wrapper input[type="file"]:hover {
            border-color: #4f46e5;
            background: #f8fafc;
        }

        .btn {
            background: #2563eb;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 6px rgba(37, 99, 235, 0.3);
        }

        .btn:hover {
            background: #1d4ed8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
        }

        .btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .status-message {
            margin-top: 15px;
            padding: 12px;
            border-radius: 6px;
            display: none;
        }

        .status-message.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }

        .status-message.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }

        .status-message.info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #3b82f6;
        }

        .results-section {
            display: none;
            margin-top: 30px;
        }

        .dashboard-header {
            background: #0f766e;
            color: white;
            padding: 15px 20px;
            border-radius: 8px 8px 0 0;
            font-size: 16px;
            font-weight: bold;
        }

        .graph-container {
            background: white;
            border: 3px solid #e5e7eb;
            border-radius: 0 0 8px 8px;
            padding: 20px;
            text-align: center;
            min-height: 400px;
        }

        .graph-container img {
            max-width: 100%;
            height: auto;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .metrics-section {
            background: #dbeafe;
            border: 2px solid #93c5fd;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .metrics-section h3 {
            color: #1e40af;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .metrics-content {
            background: white;
            padding: 20px;
            border-radius: 6px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.8;
            color: #1e3a8a;
            overflow-x: auto;
        }

        .info-section {
            background: #fef3c7;
            border: 2px solid #fde68a;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .info-section h3 {
            color: #92400e;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .info-content {
            color: #78350f;
            line-height: 1.8;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #2563eb;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .file-info {
            margin-top: 10px;
            font-size: 14px;
            color: #059669;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìä Page Scroll Performance Monitor</h1>
        <p>Compare two Pages Scroll to analyze scroll smoothness and performance</p>
    </div>

    <div class="container">
        <div class="upload-section">
            <h2>üìÅ Compare Two Pages Scroll (Upload)</h2>
            <form id="compareForm">
                <div class="file-upload">
                    <div class="file-input-wrapper">
                        <label for="video1">Video 1:</label>
                        <input type="file" id="video1" name="video1" accept="video/*" required>
                        <div class="file-info" id="file1-info"></div>
                    </div>
                    <div class="file-input-wrapper">
                        <label for="video2">Video 2:</label>
                        <input type="file" id="video2" name="video2" accept="video/*" required>
                        <div class="file-info" id="file2-info"></div>
                    </div>
                </div>
                <button type="submit" class="btn" id="compareBtn">Compare Videos</button>
                <div class="status-message" id="statusMessage"></div>
            </form>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Analyzing videos... This may take a few moments.</p>
        </div>

        <div class="results-section" id="resultsSection">
            <div class="dashboard-header">
                üìä Performance Analysis Dashboard
            </div>
            <div class="graph-container">
                <img id="dashboardImage" src="" alt="Comparison Dashboard">
            </div>

            <div class="metrics-section">
                <h3>üìà Overall Rating and Metrics</h3>
                <div class="metrics-content" id="metricsContent"></div>
            </div>

            <div class="info-section">
                <h3>üí° What the graphs show (Performance Analysis)</h3>
                <div class="info-content">
                    <p><strong>üìä Top chart (blue line) - Scroll Movement:</strong></p>
                    <ul>
                        <li>Smooth, steady line = Good performance, content scrolls evenly</li>
                        <li>Sharp spikes/peaks = Performance lag detected - jerky, uneven scrolling</li>
                        <li>High values = Content is moving a lot (normal during scroll)</li>
                        <li>Low values = Content barely moving (may indicate lag or end of scroll)</li>
                    </ul>
                    <p style="margin-top: 15px;"><strong>‚è±Ô∏è Bottom chart (orange/green lines) - Frame Timing:</strong></p>
                    <ul>
                        <li>Flat, steady line = Excellent performance - smooth animation</li>
                        <li>Tall spikes = Performance lag detected - visible stutter/pause</li>
                        <li>Green dashed line = Average timing (target to stay close to)</li>
                        <li>Large gaps above average = Frame drops causing noticeable lag</li>
                    </ul>
                </div>
            </div>

            <div class="info-section" style="margin-top: 20px;">
                <h3>üìö Reference Ranges (What the Numbers Mean)</h3>
                <div class="info-content">
                    <p><strong>üìä ACTIVITY SCORE:</strong> How much content moves during scrolling (higher = more movement, neither high nor low is inherently better)</p>
                    <p><strong>‚ö° JERKINESS:</strong> How consistent the motion is (lower is better)</p>
                    <ul>
                        <li>Excellent: &lt; 2.0 (very consistent motion)</li>
                        <li>Good: &lt; 5.0 (mostly smooth)</li>
                        <li>Fair: &lt; 10.0 (some variability)</li>
                        <li>Poor: ‚â• 10.0 (very jerky)</li>
                    </ul>
                    <p><strong>‚è±Ô∏è FRAME-TIME JITTER:</strong> Variation in time between frames in milliseconds (lower is better)</p>
                    <ul>
                        <li>Excellent: &lt; 3 ms (perfectly smooth, industry benchmark)</li>
                        <li>Good: &lt; 8 ms (smooth scrolling)</li>
                        <li>Fair: &lt; 16 ms (noticeable but acceptable, target: 60 FPS = 16.67 ms)</li>
                        <li>Poor: ‚â• 16 ms (significant stutter, below 60 FPS)</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('compareForm');
        const compareBtn = document.getElementById('compareBtn');
        const statusMessage = document.getElementById('statusMessage');
        const loading = document.getElementById('loading');
        const resultsSection = document.getElementById('resultsSection');
        const dashboardImage = document.getElementById('dashboardImage');
        const metricsContent = document.getElementById('metricsContent');
        const video1Input = document.getElementById('video1');
        const video2Input = document.getElementById('video2');
        const file1Info = document.getElementById('file1-info');
        const file2Info = document.getElementById('file2-info');

        // Show file names when selected
        video1Input.addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                file1Info.textContent = `Selected: ${e.target.files[0].name}`;
            }
        });

        video2Input.addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                file2Info.textContent = `Selected: ${e.target.files[0].name}`;
            }
        });

        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData();
            formData.append('video1', video1Input.files[0]);
            formData.append('video2', video2Input.files[0]);
            formData.append('session_id', Date.now().toString());

            // Show loading state
            compareBtn.disabled = true;
            loading.classList.add('active');
            resultsSection.style.display = 'none';
            statusMessage.style.display = 'none';

            try {
                const response = await fetch('/api/compare', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    // Display results
                    dashboardImage.src = data.dashboard_image;
                    dashboardImage.onerror = function() {
                        this.src = '';
                        this.alt = 'Dashboard image not available';
                    };

                    // Format metrics
                    const comparison = data.comparison;
                    const video1 = comparison.video1;
                    const video2 = comparison.video2;
                    const results = comparison.results;

                    let metricsText = `üìä VIDEO COMPARISON RESULTS\n`;
                    metricsText += `${'='.repeat(50)}\n\n`;
                    metricsText += `üèÜ Overall Winner: ${results.overall_winner}\n\n`;
                    metricsText += `üìπ Video 1: ${video1.name}\n`;
                    metricsText += `   Rating: ${video1.rating}\n`;
                    metricsText += `   Jerkiness: ${video1.jerkiness.toFixed(2)} ${results.better_jerkiness === 'Video 1' ? '‚úì' : ''}\n`;
                    metricsText += `   Jitter: ${video1.jitter_ms.toFixed(2)} ms ${results.better_jitter === 'Video 1' ? '‚úì' : ''}\n`;
                    metricsText += `   Estimated FPS: ${video1.estimated_fps.toFixed(1)} ${results.better_fps === 'Video 1' ? '‚úì' : ''}\n\n`;
                    metricsText += `üìπ Video 2: ${video2.name}\n`;
                    metricsText += `   Rating: ${video2.rating}\n`;
                    metricsText += `   Jerkiness: ${video2.jerkiness.toFixed(2)} ${results.better_jerkiness === 'Video 2' ? '‚úì' : ''}\n`;
                    metricsText += `   Jitter: ${video2.jitter_ms.toFixed(2)} ms ${results.better_jitter === 'Video 2' ? '‚úì' : ''}\n`;
                    metricsText += `   Estimated FPS: ${video2.estimated_fps.toFixed(1)} ${results.better_fps === 'Video 2' ? '‚úì' : ''}\n\n`;
                    metricsText += `üí° Interpretation:\n`;
                    metricsText += `   ‚Ä¢ Lower jerkiness = smoother, more consistent motion\n`;
                    metricsText += `   ‚Ä¢ Lower jitter = more stable frame timing (target < 8ms)\n`;
                    metricsText += `   ‚Ä¢ Higher FPS = smoother scrolling (target: 60 FPS)`;

                    metricsContent.textContent = metricsText;
                    resultsSection.style.display = 'block';
                    
                    showMessage('Comparison completed successfully!', 'success');
                } else {
                    showMessage(data.error || 'Comparison failed', 'error');
                }
            } catch (error) {
                showMessage('Error: ' + error.message, 'error');
            } finally {
                compareBtn.disabled = false;
                loading.classList.remove('active');
            }
        });

        function showMessage(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = `status-message ${type}`;
            statusMessage.style.display = 'block';
        }
    </script>
</body>
</html>
